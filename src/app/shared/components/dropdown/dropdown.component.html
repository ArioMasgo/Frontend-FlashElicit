<div class="relative">
  <!-- Botón principal -->
  <button
    #dropdownButton
    type="button"
    (click)="toggleDropdown()"
    [class]="buttonClass() || 'p-2 rounded-md transition-all duration-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700'"
    [attr.aria-label]="ariaLabel()"
    [attr.aria-expanded]="isOpen()"
  >
    <!-- Contenido del botón personalizado o por defecto -->
    <ng-container *ngIf="buttonTemplate(); else defaultButton">
      <ng-container *ngTemplateOutlet="buttonTemplate()!; context: { $implicit: getSelectedOption() }"></ng-container>
    </ng-container>
    <ng-template #defaultButton>
      <span class="text-gray-900 dark:text-gray-100">{{ buttonLabel() || getSelectedOption()?.label }}</span>
    </ng-template>
  </button>
</div>

<!-- Backdrop para cerrar al hacer click fuera -->
@if (isOpen()) {
  <div
    class="fixed inset-0 z-[999]"
    (click)="closeDropdown()"
  ></div>
}

<!-- Dropdown Menu (fuera del contenedor relativo) -->
@if (isOpen() && dropdownPosition()) {
  <div
    [class]="'fixed rounded-md shadow-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 overflow-hidden z-[1000] animate-in fade-in slide-in-from-top-2 duration-200 ' + dropdownWidth()"
    [style.top]="dropdownPosition()!.top"
    [style.left]="dropdownPosition()!.left"
    [style.right]="dropdownPosition()!.right"
  >
    @for (option of options(); track option.value) {
      <button
        type="button"
        (click)="selectOption(option.value)"
        class="w-full px-3 py-2.5 text-left flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-sm"
        [class.bg-gray-100]="selectedValue() === option.value"
        [class.dark:bg-gray-700]="selectedValue() === option.value"
      >
        <!-- Contenido de opción personalizado o por defecto -->
        <ng-container *ngIf="optionTemplate(); else defaultOption">
          <ng-container *ngTemplateOutlet="optionTemplate()!; context: { $implicit: option, selected: selectedValue() === option.value }"></ng-container>
        </ng-container>
        <ng-template #defaultOption>
          @if (option.icon) {
            <span [innerHTML]="option.icon" class="w-4 h-4"></span>
          }
          <div class="flex-1">
            <div class="text-gray-900 dark:text-gray-100 font-medium">{{ option.label }}</div>
            @if (option.description) {
              <div class="text-xs text-gray-500 dark:text-gray-400">{{ option.description }}</div>
            }
          </div>
          @if (selectedValue() === option.value) {
            <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
          }
        </ng-template>
      </button>
    }
  </div>
}
