<div class="min-h-screen bg-gray-50 dark:bg-[#1a1f2e] flex flex-col transition-colors duration-300">
  <app-header />

  <!-- Main Content -->
  <main class="flex-1 px-4 py-8">
    <div class="max-w-3xl mx-auto">
      <!-- TÃ­tulo y formulario centrado -->
      <div class="text-center mb-8">
        <!-- Icon -->
        <div class="mb-6 flex justify-center">
          <div class="relative">
            <div class="w-20 h-20 bg-gradient-to-br from-dark-blue-500 to-dark-blue-600 rounded-full flex items-center justify-center shadow-xl">
              <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
            </div>
            <!-- Glow effect -->
            <div class="absolute inset-0 w-20 h-20 bg-dark-blue-500 rounded-full opacity-20 blur-xl"></div>
          </div>
        </div>

        <!-- Title -->
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-3">
          Iniciar ElicitaciÃ³n de Requisitos
        </h2>

        <!-- Input Form Container -->
        <form [formGroup]="elicitationForm" (ngSubmit)="onSubmit()" class="w-full bg-white dark:bg-[#252b3d] rounded-xl border border-gray-300 dark:border-gray-700 shadow-lg overflow-hidden">
          <!-- Input Area -->
          <div class="p-4 relative">
            <textarea
              formControlName="userInput"
              [placeholder]="placeholder()"
              (blur)="onInputBlur()"
              [class.pr-12]="selectedInputType() === 'appLink'"
              class="w-full min-h-[2.5rem] max-h-48 bg-transparent text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 resize-none focus:outline-none text-base disabled:opacity-50"
              [style.height]="'auto'"
              (input)="$any($event.target).style.height = 'auto'; $any($event.target).style.height = $any($event.target).scrollHeight + 'px'"
            ></textarea>

            <!-- BotÃ³n de criterios de bÃºsqueda - Solo para Link de app -->
            @if (selectedInputType() === 'appLink') {
              <div class="absolute top-4 right-4">
                <button
                  type="button"
                  (click)="toggleCriteriosDropdown()"
                  class="p-1.5 rounded-md transition-all duration-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600"
                  [attr.aria-label]="'Criterios de bÃºsqueda'"
                  [attr.aria-expanded]="isCriteriosDropdownOpen()"
                  title="Criterios de bÃºsqueda"
                >
                  <!-- Icono de ajustes/filtro -->
                  <svg class="w-4 h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12" />
                  </svg>
                </button>

                <!-- Dropdown Menu -->
                @if (isCriteriosDropdownOpen()) {
                  <div class="absolute right-0 mt-2 w-44 rounded-md shadow-lg bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 overflow-hidden z-50 animate-in fade-in slide-in-from-top-2 duration-200">
                    <!-- OpciÃ³n: MÃ¡s recientes -->
                    <button
                      type="button"
                      (click)="selectCriterio('recientes')"
                      class="w-full px-3 py-2.5 text-left flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-sm"
                      [class.bg-gray-100]="criteriosBusqueda() === 'recientes'"
                      [class.dark:bg-gray-700]="criteriosBusqueda() === 'recientes'"
                    >
                      <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <span class="flex-1 text-gray-900 dark:text-gray-100">MÃ¡s recientes</span>
                      @if (criteriosBusqueda() === 'recientes') {
                        <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                      }
                    </button>

                    <!-- OpciÃ³n: MÃ¡s relevantes -->
                    <button
                      type="button"
                      (click)="selectCriterio('relevantes')"
                      class="w-full px-3 py-2.5 text-left flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-sm"
                      [class.bg-gray-100]="criteriosBusqueda() === 'relevantes'"
                      [class.dark:bg-gray-700]="criteriosBusqueda() === 'relevantes'"
                    >
                      <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                      </svg>
                      <span class="flex-1 text-gray-900 dark:text-gray-100">MÃ¡s relevantes</span>
                      @if (criteriosBusqueda() === 'relevantes') {
                        <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                      }
                    </button>
                  </div>
                }

                <!-- Backdrop para cerrar al hacer click fuera -->
                @if (isCriteriosDropdownOpen()) {
                  <div
                    class="fixed inset-0 z-40"
                    (click)="closeCriteriosDropdown()"
                  ></div>
                }
              </div>
            }
          </div>

          <!-- Bottom Bar -->
          <div class="flex items-center justify-between px-4 py-3 bg-gray-50 dark:bg-[#1e2433] border-t border-gray-200 dark:border-gray-700">
            <!-- Left Side: Action Buttons -->
            <div class="flex items-center gap-2">
              <!-- Comentario Button -->
              <button
                type="button"
                (click)="selectInputType('comment')"
                [class.bg-dark-blue-100]="selectedInputType() === 'comment'"
                [class.dark:bg-dark-blue-900]="selectedInputType() === 'comment'"
                [class.text-dark-blue-700]="selectedInputType() === 'comment'"
                [class.dark:text-dark-blue-300]="selectedInputType() === 'comment'"
                class="flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                </svg>
                <span>Comentario</span>
              </button>

              <!-- Link de app Button -->
              <button
                type="button"
                (click)="selectInputType('appLink')"
                [class.bg-dark-blue-100]="selectedInputType() === 'appLink'"
                [class.dark:bg-dark-blue-900]="selectedInputType() === 'appLink'"
                [class.text-dark-blue-700]="selectedInputType() === 'appLink'"
                [class.dark:text-dark-blue-300]="selectedInputType() === 'appLink'"
                class="flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                </svg>
                <span>Link de app</span>
              </button>
            </div>

            <!-- Right Side: Send Button -->
            <button
              type="submit"
              [disabled]="!isFormValid()"
              [class.opacity-50]="!isFormValid()"
              [class.cursor-not-allowed]="!isFormValid()"
              [class.hover:bg-dark-blue-700]="isFormValid()"
              class="p-2 rounded-lg bg-dark-blue-600 text-white transition-all disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
          </div>

          <!-- Error Message -->
          @if (errorMessage()) {
            <div class="px-4 py-2 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800">
              <p class="text-xs text-red-600 dark:text-red-400 flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                {{ errorMessage() }}
              </p>
            </div>
          }
        </form>

        <!-- Helper text -->
        <p class="text-gray-600 dark:text-gray-500 text-xs mt-4">
          @if (selectedInputType() === 'comment') {
            ðŸ’¡ Escribe al menos 6 palabras para describir tu idea o requisito
          } @else {
            ðŸ”— Ejemplo: https://play.google.com/store/apps/details?id=com.bcp.bank.bcp&hl=es_419
          }
        </p>
      </div>
    </div>
    <div class="max-w-7xl mx-auto">
      <!-- Resultados -->
      @if (resultadoComentario()) {
        <div class="mt-8 animate-fade-in">
          <app-requisitos-comentario-unico [resultado]="resultadoComentario()!" />
        </div>
      }

      @if (resultadoScraping()) {
        <div class="mt-8 animate-fade-in">
          <app-requisitos-scraping [resultado]="resultadoScraping()!" />
        </div>
      }
    </div>
  </main>
  <app-footer />
</div>
