<div class="min-h-screen bg-gray-50 dark:bg-[#1a1f2e] flex flex-col transition-colors duration-300">
  <app-header />

  <!-- Main Content -->
  <main class="flex-1 px-4 py-8">
    <div class="max-w-3xl mx-auto">
      <!-- TÃ­tulo y formulario centrado -->
      <div class="text-center mb-8">
        <!-- Icon -->
        <div class="mb-6 flex justify-center">
          <div class="relative">
            <div class="w-20 h-20 bg-gradient-to-br from-dark-blue-500 to-dark-blue-600 rounded-full flex items-center justify-center shadow-xl">
              <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
              </svg>
            </div>
            <!-- Glow effect -->
            <div class="absolute inset-0 w-20 h-20 bg-dark-blue-500 rounded-full opacity-20 blur-xl"></div>
          </div>
        </div>

        <!-- Title -->
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 dark:text-white mb-3">
          Iniciar ElicitaciÃ³n de Requisitos
        </h2>

        <!-- Input Form Container -->
        <form [formGroup]="elicitationForm" (ngSubmit)="onSubmit()" class="w-full bg-white dark:bg-[#252b3d] rounded-xl border border-gray-300 dark:border-gray-700 shadow-lg overflow-hidden">
          <!-- Input Area -->
          <div class="p-4 relative">
            <textarea
              formControlName="userInput"
              [placeholder]="placeholder()"
              (blur)="onInputBlur()"
              class="w-full min-h-[2.5rem] max-h-48 bg-transparent text-gray-900 dark:text-white placeholder-gray-400 dark:placeholder-gray-500 resize-none focus:outline-none text-base disabled:opacity-50"
              [style.height]="'auto'"
              (input)="$any($event.target).style.height = 'auto'; $any($event.target).style.height = $any($event.target).scrollHeight + 'px'"
            ></textarea>
          </div>

          <!-- Bottom Bar -->
          <div class="flex items-center justify-between px-2 sm:px-4 py-2 sm:py-3 bg-gray-50 dark:bg-[#1e2433] border-t border-gray-200 dark:border-gray-700">
            <!-- Left Side: Action Buttons / Input Type Selector -->

            <!-- Desktop: Botones -->
            <div class="hidden sm:flex items-center gap-2">
              <!-- Comentario Button -->
              <button
                type="button"
                (click)="selectInputType('comment')"
                [class.bg-dark-blue-100]="selectedInputType() === 'comment'"
                [class.dark:bg-dark-blue-900]="selectedInputType() === 'comment'"
                [class.text-dark-blue-700]="selectedInputType() === 'comment'"
                [class.dark:text-dark-blue-300]="selectedInputType() === 'comment'"
                class="flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                </svg>
                <span>Comentario</span>
              </button>

              <!-- Link de app Button -->
              <button
                type="button"
                (click)="selectInputType('appLink')"
                [class.bg-dark-blue-100]="selectedInputType() === 'appLink'"
                [class.dark:bg-dark-blue-900]="selectedInputType() === 'appLink'"
                [class.text-dark-blue-700]="selectedInputType() === 'appLink'"
                [class.dark:text-dark-blue-300]="selectedInputType() === 'appLink'"
                class="flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                </svg>
                <span>Link de app</span>
              </button>
            </div>

            <!-- Mobile: Dropdown -->
            <div class="sm:hidden">
              <app-dropdown
                #inputTypeDropdown
                [options]="inputTypeOptions"
                [selectedValue]="selectedInputType()"
                (selectionChange)="onInputTypeChange($event)"
                (dropdownOpened)="onInputTypeDropdownOpened()"
                [buttonClass]="'px-2 py-1 rounded-lg text-xs font-medium transition-all duration-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 flex items-center gap-1.5'"
                [ariaLabel]="'Seleccionar tipo de entrada'"
                [dropdownWidth]="'w-56'"
                [align]="'left'"
              >
                <ng-template #buttonContent let-option>
                  @if (selectedInputType() === 'comment') {
                    <svg class="w-3.5 h-3.5 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                    </svg>
                    <span class="text-xs text-gray-900 dark:text-gray-100">Comentario</span>
                  } @else {
                    <svg class="w-3.5 h-3.5 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    <span class="text-xs text-gray-900 dark:text-gray-100">Link</span>
                  }
                  <svg class="w-3 h-3 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </ng-template>
                <ng-template #optionContent let-option let-selected="selected">
                  @if (option.value === 'comment') {
                    <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                    </svg>
                  } @else {
                    <svg class="w-4 h-4 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                  }
                  <div class="flex-1">
                    <div class="text-gray-900 dark:text-gray-100 font-medium">{{ option.label }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-400">{{ option.description }}</div>
                  </div>
                  @if (selected) {
                    <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                  }
                </ng-template>
              </app-dropdown>
            </div>

            <!-- Dropdowns Container -->
            <div class="flex items-center gap-1 sm:gap-2">
              <!-- Criteria Selector Dropdown - Solo para Link de app -->
              @if (selectedInputType() === 'appLink') {
                <app-dropdown
                  #criteriosDropdown
                  [options]="criteriosOptions"
                  [selectedValue]="criteriosBusqueda()"
                  (selectionChange)="onCriterioChange($event)"
                  (dropdownOpened)="onCriteriosDropdownOpened()"
                  [buttonClass]="'px-2 py-1 sm:px-3 sm:py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 flex items-center gap-1.5 sm:gap-2'"
                  [ariaLabel]="'Criterios de bÃºsqueda'"
                  [dropdownWidth]="'w-56'"
                >
                  <ng-template #buttonContent let-option>
                    @if (criteriosBusqueda() === 'recientes') {
                      <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <span class="hidden sm:inline text-gray-900 dark:text-gray-100">MÃ¡s recientes</span>
                    } @else {
                      <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                      </svg>
                      <span class="hidden sm:inline text-gray-900 dark:text-gray-100">MÃ¡s relevantes</span>
                    }
                    <svg class="hidden sm:inline w-3 h-3 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </ng-template>
                  <ng-template #optionContent let-option let-selected="selected">
                    @if (option.value === 'recientes') {
                      <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                    } @else {
                      <svg class="w-4 h-4 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
                      </svg>
                    }
                    <div class="flex-1">
                      <div class="text-gray-900 dark:text-gray-100 font-medium">{{ option.label }}</div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">{{ option.description }}</div>
                    </div>
                    @if (selected) {
                      <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                      </svg>
                    }
                  </ng-template>
                </app-dropdown>
              }

              <!-- Model Selector Dropdown -->
              <app-dropdown
                #modelDropdown
                [options]="modelOptions"
                [selectedValue]="multiclassModel()"
                (selectionChange)="onModelChange($event)"
                (dropdownOpened)="onModelDropdownOpened()"
                [buttonClass]="'px-2 py-1 sm:px-3 sm:py-1.5 rounded-lg text-xs sm:text-sm font-medium transition-all duration-200 bg-gray-100 hover:bg-gray-200 dark:bg-gray-700 dark:hover:bg-gray-600 flex items-center gap-1.5 sm:gap-2'"
                [ariaLabel]="'Seleccionar modelo de clasificaciÃ³n'"
                [dropdownWidth]="'w-56'"
              >
              <ng-template #buttonContent let-option>
                @if (multiclassModel() === 'beto') {
                  <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
                  </svg>
                  <span class="text-gray-900 dark:text-gray-100">BETO</span>
                } @else {
                  <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
                  </svg>
                  <span class="text-gray-900 dark:text-gray-100">Robertuito</span>
                }
                <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-600 dark:text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </ng-template>
              <ng-template #optionContent let-option let-selected="selected">
                @if (option.value === 'beto') {
                  <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
                  </svg>
                } @else {
                  <svg class="w-4 h-4 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19.8 15.3M14.25 3.104c.251.023.501.05.75.082M19.8 15.3l-1.57.393A9.065 9.065 0 0112 15a9.065 9.065 0 00-6.23-.693L5 14.5m14.8.8l1.402 1.402c1.232 1.232.65 3.318-1.067 3.611A48.309 48.309 0 0112 21c-2.773 0-5.491-.235-8.135-.687-1.718-.293-2.3-2.379-1.067-3.61L5 14.5" />
                  </svg>
                }
                <div class="flex-1">
                  <div class="text-gray-900 dark:text-gray-100 font-medium">{{ option.label }}</div>
                  <div class="text-xs text-gray-500 dark:text-gray-400">{{ option.description }}</div>
                </div>
                @if (selected) {
                  <svg class="w-4 h-4 text-dark-blue-600 dark:text-dark-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                  </svg>
                }
              </ng-template>
            </app-dropdown>
            <!-- Right Side: Send Button -->
            <button
              type="submit"
              [disabled]="!isFormValid()"
              [class.opacity-50]="!isFormValid()"
              [class.cursor-not-allowed]="!isFormValid()"
              [class.hover:bg-dark-blue-700]="isFormValid()"
              class="p-1.5 sm:p-2 rounded-lg bg-dark-blue-600 text-white transition-all disabled:bg-gray-400 disabled:cursor-not-allowed"
            >
              <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="currentColor" viewBox="0 0 24 24">
                <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
              </svg>
            </button>
            </div>
        </div>

          <!-- Error Message -->
          @if (errorMessage()) {
            <div class="px-4 py-2 bg-red-50 dark:bg-red-900/20 border-t border-red-200 dark:border-red-800">
              <p class="text-xs text-red-600 dark:text-red-400 flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                {{ errorMessage() }}
              </p>
            </div>
          }
        </form>

        <!-- Helper text -->
        <p class="text-gray-600 dark:text-gray-500 text-xs mt-4">
          @if (selectedInputType() === 'comment') {
            ðŸ’¡ Escribe al menos 6 palabras para describir tu idea o requisito
          } @else {
            ðŸ”— Ejemplo: https://play.google.com/store/apps/details?id=com.bcp.bank.bcp&hl=es_419
          }
        </p>
      </div>
    </div>
    <div class="max-w-7xl mx-auto">
      <!-- Resultados -->
      @if (resultadoComentario()) {
        <div class="mt-8 animate-fade-in">
          <app-requisitos-comentario-unico [resultado]="resultadoComentario()!" />
        </div>
      }

      @if (resultadoScraping()) {
        <div class="mt-8 animate-fade-in">
          <app-requisitos-scraping [resultado]="resultadoScraping()!" />
        </div>
      }
    </div>
  </main>
  <app-footer />
</div>
